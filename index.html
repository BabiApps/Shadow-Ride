<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Theme Company</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="./suncalc.js"></script>
  <style>
  body {
    font: 400 15px Lato, sans-serif;
    line-height: 1.8;
    color: #818181;
  }
  h2 {
    font-size: 24px;
    text-transform: uppercase;
    color: #303030;
    font-weight: 600;
    margin-bottom: 30px;
  }
  h4 {
    font-size: 19px;
    line-height: 1.375em;
    color: #303030;
    font-weight: 400;
    margin-bottom: 30px;
  }  
  .jumbotron {
    background-color: #33375e;
    color: #fff;
    padding: 100px 25px;
    font-family: Montserrat, sans-serif;
  }
  .container-fluid {
    padding: 60px 50px;
  } 
  .bg-grey {
    background-color: #f6f6f6;
  }
  .logo-small {
    color: #33375e;
    font-size: 50px;
  }
  .logo {
    color: #33375e;
    font-size: 200px;
  }
  .thumbnail {
    padding: 0 0 15px 0;
    border: none;
    border-radius: 0;
  }
  .thumbnail img {
    width: 100%;
    height: 100%;
    margin-bottom: 10px;
  }
  .carousel-control.right, .carousel-control.left {
    background-image: none;
    color: #33375e;
  }
  .carousel-indicators li {
    border-color: #33375e;
  }
  .carousel-indicators li.active {
    background-color: #33375e;
  }
  .item h4 {
    font-size: 19px;
    line-height: 1.375em;
    font-weight: 400;
    font-style: italic;
    margin: 70px 0;
  }
  .item span {
    font-style: normal;
  }
  .panel {
    border: 1px solid #33375e; 
    border-radius:0 !important;
    transition: box-shadow 0.5s;
  }
  .panel:hover {
    box-shadow: 5px 0px 40px rgba(0,0,0, .2);
  }
  .panel-footer .btn:hover {
    border: 1px solid #33375e;
    background-color: #fff !important;
    color: #33375e;
  }
  .panel-heading {
    color: #fff !important;
    background-color: #33375e !important;
    padding: 25px;
    border-bottom: 1px solid transparent;
    border-top-left-radius: 0px;
    border-top-right-radius: 0px;
    border-bottom-left-radius: 0px;
    border-bottom-right-radius: 0px;
  }
  .panel-footer {
    background-color: white !important;
  }
  .panel-footer h3 {
    font-size: 32px;
  }
  .panel-footer h4 {
    color: #aaa;
    font-size: 14px;
  }
  .panel-footer .btn {
    margin: 15px 0;
    background-color: #33375e;
    color: #fff;
  }
  .navbar {
    margin-bottom: 0;
    background-color: #33375e;
    z-index: 9999;
    border: 0;
    font-size: 12px !important;
    line-height: 1.42857143 !important;
    letter-spacing: 4px;
    border-radius: 0;
    font-family: Montserrat, sans-serif;
  }
  .navbar li a, .navbar .navbar-brand {
    color: #fff !important;
  }
  .navbar-nav li a:hover, .navbar-nav li.active a {
    color: #33375e !important;
    background-color: #fff !important;
  }
  .navbar-default .navbar-toggle {
    border-color: transparent;
    color: #fff !important;
  }
  footer .glyphicon {
    font-size: 20px;
    margin-bottom: 20px;
    color: #33375e;
  }
  .slideanim {visibility:hidden;}
  .slide {
    animation-name: slide;
    -webkit-animation-name: slide;
    animation-duration: 1s;
    -webkit-animation-duration: 1s;
    visibility: visible;
  }
  @keyframes slide {
    0% {
      opacity: 0;
      transform: translateY(70%);
    } 
    100% {
      opacity: 1;
      transform: translateY(0%);
    }
  }
  @-webkit-keyframes slide {
    0% {
      opacity: 0;
      -webkit-transform: translateY(70%);
    } 
    100% {
      opacity: 1;
      -webkit-transform: translateY(0%);
    }
  }
  @media screen and (max-width: 768px) {
    .col-sm-4 {
      text-align: center;
      margin: 25px 0;
    }
    .btn-lg {
      width: 100%;
      margin-bottom: 35px;
    }
  }
  @media screen and (max-width: 480px) {
    .logo {
      font-size: 150px;
    }
  }
  </style>  
  </head>
    <body>
      <div class="jumbotron text-center">
        <h1>Shadow-Ride</h1>
        <p>We specialize in telling you where to sit</p>
        
        
      </div>
      <div class='container' style="margin-left: 30%;">
      <input type="text" placeholder="lat" id="lat"  width="12px" value="31.878745" name="lat"></input>
      <input type="text" placeholder="lon" id="lon" width="12px" value="35.246465" name="lon"></input>
      <input type="text" placeholder="radius" id="radius" width="12px" value="300" name="radius"></input>

      <button id='b1' onclick="apirequest()">click here</button>
      </div>
      <br><br>
      <!-- Collaps -->
      <div id='list' class="container" style="width:530px"></div>

    


      <script src="./fun.js"></script>
      <script>
        function routes(data)
        {
          route_data = '';
          for(i=0; i < data['route_stops'].length; i++)
          {
            route_data+=`<li><b>${data["route_stops"][i]["route"]["route_short_name"]}:</b> ${data["route_stops"][i]["route"]["route_long_name"]}</li>\n`;
          } 
          return route_data;
        }
        
        function apirequest()
        {
          var lat = document.getElementById('lat').value;
          var lon = document.getElementById('lon').value;
          var radius = document.getElementById('radius').value;
          var url='https://transit.land/api/v2/rest/stops?apikey=iMDAuMorfb5YN90M8fmjiswA5okKN0zX&feed_onestop_id=f-sv-גלים~מועצהאזוריתגולן~אפיקים~דןצפון~דןבדרום~דןבארשבע~ירושלים&lat='+lat+'&lon='+lon+'&radius='+radius+'&format=geojson';
          
          // Instantiate an new XHR Object
          const xhr = new XMLHttpRequest();

          // Open an obejct (GET/POST, PATH,
          // ASYN-TRUE/FALSE)
          xhr.open("GET", url, true);

          // When response is ready
          xhr.onload = function () {
              if (this.status === 200) {

                  // Changing string data into JSON Object
                  obj = JSON.parse(this.responseText);

                  // Getting the ul element
                  let list = document.getElementById("list");
                  str = ""
                  var n = 0;
                  while(n<obj['features'].length)
                  {
                    data = obj['features'][n]['properties'];
                    str += `<div class="panel-group">
                              <div class="panel panel-default">
                                <div class="panel-heading">
                                  <h4 class="panel-title">
                                    <a data-toggle="collapse" href="#collapse${n+1}"><b>${n+1}.</b> ${data['stop_name']} ${data['stop_code']}</a>
                                  </h4>
                                </div>
                                  <div id="collapse${n+1}" class="panel-collapse collapse">
                                    <ul class="list-group">
                                      ${ routes(data)}
                                    </ul>  
                                  </div>
                              </div>
                            </div>`; 
                    n++;
                  }
                  list.innerHTML = str;
              }
              else {
                  console.log("File not found");
              }
          }

          // At last send the request
          xhr.send();
        };
        

        function p2stops(startStop, endStop){
          date = Date.now();

          cBus = anglePer2stops(startStop, endStop);
          document.getElementById('c_bus').innerHTML=cBus;

          mishtane=SunCalc.getPosition(Date.now(), startStop.x, startStop.y);
          cSun = mishtane['azimuth']* 180 / Math.PI + 180;
          document.getElementById('c_sun').innerHTML=cSun;

          cDiff=cSun-cBus;
          document.getElementById('c_diff').innerHTML=cDiff;

          

          document.getElementById('koteret1').innerHTML=date.toString();
          document.getElementById('koteret').innerHTML=SunCalc.getTimes(/*Date*/ date, /*Number*/ 31, /*Number*/ 32, /*Number (default=0)*/ 1)["sunrise"];
          document.getElementById('mispar').innerHTML=SunCalc.getTimes(/*Date*/ date, /*Number*/ 31, /*Number*/ 32, /*Number (default=0)*/ 1)["sunset"];

        }

        
        
        //$('#here').text(result);

        function b1func(){
          x1 = document.getElementById('x1').value;
          y1 = document.getElementById('y1').value;
          x2 = document.getElementById('x2').value;
          y2 = document.getElementById('y2').value;


          p2stops({x: x1,y: y1},{x: x2,y: y2});
        };
  
      </script>
    </body>
</html>   